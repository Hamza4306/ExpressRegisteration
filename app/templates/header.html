<style>
    .navbar-brand img {
        max-height: 50px;
        width: auto;
    }

    @media (min-width: 992px) {
        .navbar .dropdown:hover>.dropdown-menu {
            display: block;
            margin-top: 0;
        }

        .navbar .dropdown>a[data-bs-toggle="dropdown"] {
            pointer-events: none;
        }
    }
    @media (max-width: 991.98px) {
        .offcanvas-body .navbar-nav .nav-item {
            border-bottom: 1px solid #e9ecef;
        }

        .offcanvas-body .navbar-nav .nav-item:last-child {
            border-bottom: none;
        }

        .offcanvas-body .navbar-nav .nav-link,
        .offcanvas-body .navbar-nav .dropdown-toggle {
            font-size: 1.15rem;
            padding: 0.75rem 1rem;
            
        }
    }

    .flag-icon {
        width: 20px;
        height: auto;
        margin-right: 0;
        border-radius: 3px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    /* Professional styles for language flags in navbar */
    .lang-flags {
        display: flex;
        align-items: center;
        margin-left: 10px;
    }
    
    .lang-flags .nav-link {
        padding: 0.5rem 0.4rem;
        margin: 0 2px;
        opacity: 0.6;
        transition: all 0.2s ease;
    }
    
    .lang-flags .nav-link:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }
    
    .lang-flags .nav-link.active {
        opacity: 1;
        position: relative;
    }
    
    .lang-flags .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: 2px;
        left: 50%;
        transform: translateX(-50%);
        width: 5px;
        height: 5px;
        background-color: #004488;
        border-radius: 50%;
    }
    
    .badge-new {
        font-size: 0.6rem;
        background-color: #EA4BC8;
        color: #fff;
        vertical-align: middle;
        margin-left: 6px;
    }
</style>
<!-- CSS styles for the announcement bar -->
<style>
    .ticker-container {
        width: 100%;
        background-color: red; 
        overflow: hidden;
        position: relative;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .ticker {
        display: flex;
        white-space: nowrap;
        padding: 8px 0;
        color: white;
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    .ticker-content {
        display: inline-flex;
        animation: ticker 50s linear infinite;
    }
    
    .ticker-item {
        padding: 0 30px;
    }
    
    @keyframes ticker {
        0% {
            transform: translateX(0%);
        }
        100% {
            transform: translateX(-100%);
        }
    }
    
    /* Pause the animation when hovered */
    .ticker:hover .ticker-content {
        animation-play-state: paused;
    }
    
    /* Responsive adjustment */
    @media (max-width: 767px) {
        .ticker {
            padding: 6px 0;
            font-size: 0.8rem;
        }
    }
</style>

<!-- Sliding Announcement Bar -->
<div class="ticker-container">
    <div class="ticker">
        <div class="ticker-content">
            {% for i in range(4) %}
            <span class="ticker-item"><i class="fas fa-bullhorn me-2"></i> <strong data-i18n="ticker-strong">Neu!</strong> <span data-i18n="ticker-content">EXPRESS Auto Anmeldung in 10 Minuten Bundesweit auch an Sonntag - und Feiertagen</span></span>
            {% endfor %}
        </div>
    </div>
</div>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="{{ url_for('core.index') }}">
            <img src="/static/assets/img/logo.jpg" alt="Logo">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNav"
            aria-controls="offcanvasNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="{{ url_for('core.checklist') }}"
                        data-i18n="checklist-nav">Checkliste</a></li>

                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('locations.overview') }}" id="locationsLink" data-i18n="locations-nav">Annahmestellen</a>
                        </li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('core.documents') }}"
                        data-i18n="documents-nav">Dokumente & Formulare</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="servicesDropdown" data-bs-toggle="dropdown"
                        aria-expanded="false">Services</a>

                    <ul class="dropdown-menu" aria-labelledby="servicesDropdown">
                        <li><a class="dropdown-item" data-i18n="register-nav" href="{{ url_for('services.register') }}">kfz-anmeldung</a></li>
                        <li><a class="dropdown-item" data-i18n="deregister-nav" href="{{ url_for('services.deregister') }}">kfz-abmeldung</a></li>
                        <li><a class="dropdown-item" data-i18n="export-nav" href="{{ url_for('services.export') }}">Zoll
                                & Export Kennzeichen</a></li>
                        <li><a class="dropdown-item" data-i18n="temporary-nav"
                                href="{{ url_for('services.temporary') }}">Kurzzeit & 6-Tages
                                Kennzeichen</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="/#kontakt" data-i18n="contact">Contact</a>
                </li>
            </ul>


            <!-- Language Flags in Navbar -->
            <div class="ms-lg-4 border-start ps-lg-3">
                <ul class="navbar-nav mb-2 mb-lg-0 lang-flags">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="selectLang('de')" title="Deutsch">
                            <img src="https://flagcdn.com/w20/de.png" alt="Deutsch" class="flag-icon">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="selectLang('en')" title="English">
                            <img src="https://flagcdn.com/w20/gb.png" alt="English" class="flag-icon">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="selectLang('ro')" title="Română">
                            <img src="https://flagcdn.com/w20/ro.png" alt="Română" class="flag-icon">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="selectLang('it')" title="Italiano">
                            <img src="https://flagcdn.com/w20/it.png" alt="Italiano" class="flag-icon">
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Offcanvas (Mobile) -->
        <div class="offcanvas offcanvas-end d-lg-none" tabindex="-1" id="offcanvasNav"
            aria-labelledby="offcanvasNavLabel">
            <div class="offcanvas-header">
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('core.checklist') }}"
                            data-i18n="checklist-nav">Checkliste</a>
                    </li>
                    
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('locations.overview') }}" id="locationsLink" data-i18n="locations-nav">Annahmestellen</a>
                        </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('core.documents') }}" data-i18n="documents-nav">Dokumente
                            &amp; Formulare</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="mobileServicesDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false" data-i18n="services-nav">Services</a>
                        <ul class="dropdown-menu" aria-labelledby="mobileServicesDropdown">
                            <li><a class="dropdown-item" data-i18n="register-nav" href="{{ url_for('services.register') }}">kfz-anmeldung</a>
                            </li>
                            <li><a class="dropdown-item" data-i18n="deregister-nav" href="{{ url_for('services.deregister') }}">kfz-abmeldung</a>
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('services.export') }}"
                                    data-i18n="export-nav">Zoll &amp; Export
                                    Kennzeichen</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('services.temporary') }}"
                                    data-i18n="temporary-nav">Kurzzeit &amp; 6-Tages
                                    Kennzeichen</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#kontakt" data-i18n="contact">Contact</a>
                    </li>
                    
                    <!-- Mobile Language Flags -->
                    <li class="nav-item">
                       <!-- <hr class="my-3"> -->
                        <p class="text-muted small ms-3 mb-2">Language / Sprache</p>
                        <div class="d-flex justify-content-start ms-2">
                            <a class="nav-link active" href="#" onclick="selectLang('de')" title="Deutsch">
                                <img src="https://flagcdn.com/w20/de.png" alt="Deutsch" class="flag-icon">
                            </a>
                            <a class="nav-link" href="#" onclick="selectLang('en')" title="English">
                                <img src="https://flagcdn.com/w20/gb.png" alt="English" class="flag-icon">
                            </a>
                            <a class="nav-link" href="#" onclick="selectLang('ro')" title="Română">
                                <img src="https://flagcdn.com/w20/ro.png" alt="Română" class="flag-icon">
                            </a>
                            <a class="nav-link" href="#" onclick="selectLang('it')" title="Italiano">
                                <img src="https://flagcdn.com/w20/it.png" alt="Italiano" class="flag-icon">
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<!-- Language Select Modal (keeping this but it may not be needed anymore) -->
<div class="modal fade" id="languageModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="languageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <h4 id="languageModalLabel">Select your language</h4>
                <p>Please choose the language you prefer:</p>

                <div class="d-flex justify-content-center gap-4 mb-4">
                    <a class="nav-link" href="#" onclick="selectLang('de')" title="Deutsch">
                        <img src="https://flagcdn.com/w40/de.png" alt="Deutsch" style="width: 40px;">
                        <div class="mt-2">Deutsch</div>
                    </a>
                    <a class="nav-link" href="#" onclick="selectLang('en')" title="English">
                        <img src="https://flagcdn.com/w40/gb.png" alt="English" style="width: 40px;">
                        <div class="mt-2">English</div>
                    </a>
                    <a class="nav-link" href="#" onclick="selectLang('ro')" title="Română">
                        <img src="https://flagcdn.com/w40/ro.png" alt="Română" style="width: 40px;">
                        <div class="mt-2">Română</div>
                    </a>
                    <a class="nav-link" href="#" onclick="selectLang('it')" title="Italiano">
                        <img src="https://flagcdn.com/w40/it.png" alt="Italiano" style="width: 40px;">
                        <div class="mt-2">Italiano</div>
                    </a>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Continue
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Professional language selection function with visual feedback
function selectLang(lang) {
    // Update active class on all flag elements
    document.querySelectorAll('.lang-flags .nav-link').forEach(item => {
        item.classList.remove('active');
    });
    
    // Find the clicked language flag and add active class
    document.querySelectorAll(`.lang-flags .nav-link[onclick="selectLang('${lang}')"]`).forEach(item => {
        item.classList.add('active');
    });
    
    // In mobile view
    document.querySelectorAll('.offcanvas-body .nav-link[onclick^="selectLang"]').forEach(item => {
        item.classList.remove('active');
    });
    document.querySelectorAll(`.offcanvas-body .nav-link[onclick="selectLang('${lang}')"]`).forEach(item => {
        item.classList.add('active');
    });
    
    // Visual feedback animation
    const flagElement = document.querySelector(`.lang-flags .nav-link[onclick="selectLang('${lang}')"] img`);
    if (flagElement) {
        flagElement.style.transform = 'scale(1.2)';
        setTimeout(() => {
            flagElement.style.transform = '';
        }, 200);
    }
    
    // Store the selected language in localStorage
    localStorage.setItem('lang', lang);
    
    // Redirect with language parameter
    const base = window.location.href.split('?')[0];
    window.location.href = `${base}?lang=${lang}`;
    
    // Close the modal if it's open
    const languageModal = document.getElementById('languageModal');
    if (languageModal) {
        const bsModal = bootstrap.Modal.getInstance(languageModal);
        if (bsModal) {
            bsModal.hide();
        }
    }
}

// Initialize with animation when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Get the current language
    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get('lang');
    const storedLang = localStorage.getItem('lang');
    const currentLang = langParam || storedLang || 'de';
    
    // Update active class on all flag elements
    document.querySelectorAll('.lang-flags .nav-link').forEach(item => {
        item.classList.remove('active');
    });
    
    // Find and activate the current language flag
    document.querySelectorAll(`.lang-flags .nav-link[onclick="selectLang('${currentLang}')"]`).forEach(item => {
        item.classList.add('active');
    });
    
    // In mobile view
    document.querySelectorAll('.offcanvas-body .nav-link[onclick^="selectLang"]').forEach(item => {
        item.classList.remove('active');
    });
    document.querySelectorAll(`.offcanvas-body .nav-link[onclick="selectLang('${currentLang}')"]`).forEach(item => {
        item.classList.add('active');
    });
    
    // Apply animation to the current language flag
    const flagElement = document.querySelector(`.lang-flags .nav-link[onclick="selectLang('${currentLang}')"] img`);
    if (flagElement) {
        flagElement.style.transform = 'scale(1.2)';
        setTimeout(() => {
            flagElement.style.transform = '';
        }, 200);
    }
});
</script>